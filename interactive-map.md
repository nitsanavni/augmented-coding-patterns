# Interactive Map Feature Plan

## Overview
Add an interactive visual map to the Talk page that shows all patterns, anti-patterns, and obstacles with their relationships.

## Architecture

### Source Files
- **Raw map**: `/website/app/talk/map.svg` - Original Excalidraw export (source)
- **Conversion script**: `/tools/process_map.py` - Transforms raw SVG into semantic SVG
- **Tests**: `/tools/tests/` - Golden file tests for conversion process
- **Map index**: `/website/public/maps/map-index.json` - Maps numbers to patterns/categories/slugs

### Generated Files
- **Semantic map**: `/website/public/maps/semantic_map.svg` - Enriched SVG with metadata attributes
- Generated by running: `python tools/process_map.py`

### How Conversion Works
The conversion script (`process_map.py`) reverse-engineers semantic meaning from visual layout:

1. **Scans shapes** by fill color:
   - `#ffc9c9` = Obstacle (light red)
   - `#b2f2bb` = Pattern (light green)
   - `#ffec99` = Anti-Pattern (light yellow)
   - `#a5d8ff` = Pit Stop (light blue)

2. **Extracts text labels** and their positions

3. **Separates legend from interactive elements** - Legend items sit near category labels

4. **Matches by proximity**:
   - Shape to pattern name (within 150px)
   - Shape to number (within 60px)

5. **Outputs semantic SVG** with grouped elements and metadata attributes:
   - `.interactive-node` with `data-label`, `data-number`, `data-color`
   - `.non-interactive-element` for legend items

### Map Index Structure
`/website/public/maps/map-index.json`:
```json
{
  "1": {
    "name": "Context Management",
    "category": "patterns",
    "slug": "context-management"
  }
}
```

Maps the numbered nodes (1-27) to actual content in the system.

## Implementation Stages

### Stage 1: Static Interactive Map ✅ Planning Complete
**Goal**: Display the map on Talk page with hover effects only

**Tasks**:
1. Copy raw `map.svg` from `/Users/ladak/workspace/talk_prep/interactive_pattern_map/docs/maps/map.svg`
2. Migrate conversion script from interactive_pattern_map to `/tools/process_map.py`
3. Migrate tests (including golden files) to `/tools/tests/`
4. Run conversion to generate semantic SVG
5. Create React component to display SVG on Talk page
6. Add hover effects (scale + brightness) using CSS
7. No click handling yet - just visual display

**Technical Details**:
- SVG inline embedded (not Canvas/WebGL)
- Static resolution (no pan/zoom)
- Pure CSS hover effects (2% scale + brightness)
- No external visualization libraries needed

### Stage 2: Click Interaction (Future)
**Goal**: Click pattern node → display pattern details

**Approach**:
1. Add click handlers to `.interactive-node` elements
2. Extract `data-number` from clicked node
3. Lookup in `map-index.json` to get category/slug
4. Display pattern details in side panel or navigate to pattern page
5. Reuse existing markdown data via `lib/markdown.ts`

## Workflow

### When Map Changes (Manual Process)
1. Update map in Excalidraw, export to `/website/app/talk/map.svg`
2. Run: `python tools/process_map.py`
3. Review generated `/website/public/maps/semantic_map.svg`
4. Update `/website/public/maps/map-index.json` if numbers changed
5. Commit all changes

### Build Process
- Conversion runs manually (not part of build)
- Generated semantic SVG is committed to repo
- Next.js serves it as static asset from `/public/maps/`

## Migration Source
Original repo: `/Users/ladak/workspace/talk_prep/interactive_pattern_map`

Files to migrate:
- `docs/maps/map.svg` → `/website/app/talk/map.svg`
- `playground/process_unified_map.py` → `/tools/process_map.py`
- `tests/` → `/tools/tests/`
- Update paths in tests to be relative to this repo

## Notes
- Map has 27 numbered items currently
- All mapped in `map-index.json`
- Tests include golden file comparisons to catch conversion regressions
- Dark theme variant exists in original repo but not planned for Stage 1
